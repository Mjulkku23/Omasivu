<!DOCTYPE html>
<html lang="fi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Liukko Olavi – Etusivu</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    :root {
      --bg:#0b1e3a; --bg-2:#10294e; --text:#e6ecff; --muted:#b7c2e5;
      --accent:#5aa8ff; --success:#2fd37d; --danger:#ff5a7a; --card-radius:1.25rem; --ring:0 0 0 .25rem rgba(90,168,255,.25);
    }

    /* yleinen */
    html,body{background:var(--bg);color:var(--text)}
    html{ scroll-behavior:smooth; }
    a{color:var(--accent)} a:hover{color:#b8d7ff}

    /* NAVBAR */
    .navbar{
      background:linear-gradient(180deg,rgba(10,25,50,.95),rgba(10,25,50,.75));
      backdrop-filter:blur(6px);
      border-bottom:1px solid rgba(255,255,255,.06);
      transition: box-shadow .25s ease;
    }
    .navbar.is-scrolled{ box-shadow:0 8px 24px rgba(0,0,0,.25); }
    .navbar .nav-link{ color:#dfe6ff; opacity:.9; }
    .navbar .nav-link:hover{ color:#ffffff; opacity:1; }
    .navbar .nav-link.active{
      color:#fff;
      position:relative;
    }
    .navbar .nav-link.active::after{
      content:"";
      position:absolute; left:0; right:0; bottom:-8px;
      height:2px; background:var(--accent);
    }

    /* osioiden ankkurioffset – päivitetään JS:llä myös */
    header.hero, section[id]{ scroll-margin-top: 84px; }

    .hero{background:radial-gradient(1200px 600px at 10% -10%, rgba(90,168,255,.25), transparent),radial-gradient(1000px 500px at 90% -20%, rgba(47,211,125,.15), transparent),var(--bg);padding:6rem 0 4rem}
    .card-dark{background:var(--bg-2);border:1px solid rgba(255,255,255,.08);border-radius:var(--card-radius)}
    .btn-accent{--bs-btn-color:#001935;--bs-btn-bg:var(--accent);--bs-btn-border-color:var(--accent);--bs-btn-hover-bg:#71b6ff;--bs-btn-hover-border-color:#71b6ff;--bs-btn-focus-shadow-rgb:90,168,255;box-shadow:var(--ring)}

    .avatar-placeholder{
      width:100%; aspect-ratio:1/1; border-radius:1rem; border:2px dashed rgba(255,255,255,.25);
      display:grid; place-items:center; color:var(--muted);
      background:repeating-linear-gradient(45deg, rgba(255,255,255,.04), rgba(255,255,255,.04) 12px, transparent 12px, transparent 24px), var(--bg-2);
      overflow:hidden
    }
    @media (min-width: 992px){ .avatar-placeholder{ max-width:320px; margin-left:auto; margin-right:auto; } }

    .section-title{font-weight:700;letter-spacing:.3px}
    table td,table th{color:var(--text);border-color:rgba(255,255,255,.08)!important}
    footer{border-top:1px solid rgba(255,255,255,.08);background:#0a1932}
    .answer-btn{border:1px solid rgba(255,255,255,.12)}
    .answer-btn.is-correct{background:rgba(47,211,125,.15);border-color:var(--success);color:#d9ffe9}
    .answer-btn.is-wrong{background:rgba(255,90,122,.15);border-color:var(--danger);color:#ffd9e1}
    .answer-btn:disabled{opacity:1}

    /* 3D-tausta */
    html, body { background: transparent !important; }
    .hero { background-color: transparent !important; }
    #space3d{ position: fixed; inset: 0; z-index: 0; pointer-events: none; }
    .navbar, .hero, section, footer { position: relative; z-index: 2; }

    /* lasinen hero-laatikko */
    .glass-hero{
      background: rgba(20,28,40,.45);
      border:1px solid rgba(255,255,255,.08);
      border-radius:1rem;
      box-shadow:0 10px 30px rgba(0,0,0,.25);
      backdrop-filter:blur(6px); -webkit-backdrop-filter:blur(6px);
      padding:1.5rem;
    }

    /* yhteys-lomake */
    .contact-card{
      background:rgba(16,41,78,.6);
      border:1px solid rgba(255,255,255,.08);
      border-radius:var(--card-radius);
      backdrop-filter: blur(6px);
      -webkit-backdrop-filter: blur(6px);
    }
    .form-control, .form-select{
      background:#0f2242; border-color:rgba(255,255,255,.15); color:var(--text);
    }
    .form-control:focus{
      border-color:var(--accent); box-shadow:var(--ring);
      background:#102647; color:var(--text);
    }

    /* Tietovisa – välit */
    .quiz-card{ background:rgba(16,41,78,.6); border:1px solid rgba(255,255,255,.08); border-radius:1rem; padding:1.25rem; margin-bottom:1rem; }
    .quiz-options .answer-btn{ display:block; width:100%; text-align:left; padding:.75rem 1rem; border-radius:.75rem; }
    .quiz-options{ display:grid; gap:.5rem; }

    /* FLOATING NAV (oikealla) */
    #floatNav{
      position: fixed;
      top: 50%;
      right: 16px;
      transform: translateY(-50%);
      z-index: 3;
      background: rgba(16,41,78,.6);
      border:1px solid rgba(255,255,255,.08);
      border-radius: 1rem;
      backdrop-filter: blur(6px);
      -webkit-backdrop-filter: blur(6px);
      padding: .5rem;
      box-shadow: 0 10px 30px rgba(0,0,0,.25);
    }
    #floatNav a{
      display:block;
      white-space:nowrap;
      color:#dfe6ff;
      text-decoration:none;
      padding:.45rem .75rem;
      border-radius:.75rem;
      border:1px solid transparent;
      font-size:.925rem;
    }
    #floatNav a:hover{ color:#fff; background:rgba(255,255,255,.06); }
    #floatNav a.active{
      color:#001935;
      background:var(--accent);
      border-color:var(--accent);
      box-shadow: var(--ring);
    }
    @media (max-width: 991.98px){
      #floatNav{ display:none !important; }
    }

    /* BACK TO TOP */
    #toTop{
      position: fixed;
      right: 20px;
      bottom: 20px;
      z-index: 3;
      opacity: 0;
      visibility: hidden;
      transform: translateY(8px);
      transition: all .2s ease;
    }
    #toTop.is-visible{
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
    }
  </style>
</head>
<body data-bs-target="#mainNav">

  <!-- Three.js -taustakerros -->
  <div id="space3d" aria-hidden="true"></div>

  <!-- Header / Navigaatio -->
  <nav id="mainNav" class="navbar navbar-expand-lg sticky-top" data-bs-theme="dark">
    <div class="container">
      <a class="navbar-brand fw-semibold text-light" href="#top">Liukko Olavi</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#nav" aria-label="Valikko"><span class="navbar-toggler-icon"></span></button>
      <div class="collapse navbar-collapse" id="nav">
        <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
          <li class="nav-item"><a class="nav-link" href="#minitieto">Minä</a></li>
          <li class="nav-item"><a class="nav-link" href="#terveys">Terveys</a></li>
          <li class="nav-item"><a class="nav-link" href="#osaamiset">Osaamiset</a></li>
          <li class="nav-item"><a class="nav-link" href="#koulutus">Koulutus</a></li>
          <li class="nav-item"><a class="nav-link" href="#tietovisa">Tietovisa</a></li>
          <li class="nav-item"><a class="nav-link" href="#yhteys">Yhteys</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- FLOATING NAV (oikea reuna) -->
  <nav id="floatNav" class="d-none d-lg-flex flex-column gap-1">
    <a href="#minitieto" data-target="minitieto">Minä</a>
    <a href="#terveys" data-target="terveys">Terveys</a>
    <a href="#osaamiset" data-target="osaamiset">Osaamiset</a>
    <a href="#koulutus" data-target="koulutus">Koulutus</a>
    <a href="#tietovisa" data-target="tietovisa">Tietovisa</a>
    <a href="#yhteys" data-target="yhteys">Yhteys</a>
  </nav>

  <!-- BACK TO TOP -->
  <button id="toTop" class="btn btn-accent btn-lg" aria-label="Takaisin ylös">↑</button>

  <!-- Hero -->
  <header id="top" class="hero">
    <div class="container">
      <div class="row align-items-center g-4">
        <div class="col-12 col-lg-6">
          <div class="glass-hero">
            <h1 class="display-5 fw-bold mb-3">Tere! <span class="text-decoration-underline">Liukko Olavi</span>.</h1>
            <p class="lead mb-0">Tässä eka omasivuni toevottavasti kelepaa.</p>
          </div>
          <div class="d-flex gap-3 mt-4">
            <a class="btn btn-accent btn-lg" href="#osaamiset">Tutustu osaamiseeni</a>
            <a class="btn btn-outline-light btn-lg" href="#koulutus">Katso koulutus</a>
          </div>
        </div>
        <div class="col-12 col-lg-6">
          <div class="avatar-placeholder overflow-hidden p-0">
            <!-- GitHub Pages -polku (assets/omakuva.png) -->
            <img
              id="omakuva"
              src="assets/omakuva.png"
              alt="Omakuva"
              loading="lazy"
              class="w-100 h-100"
              style="object-fit:cover;border-radius:1rem;"
              onerror="this.onerror=null;this.src='https://placehold.co/600x600/10294e/e6ecff?text=Omakuva';"
            />
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- Minä-tieto -->
  <section id="minitieto" class="py-5">
    <div class="container">
      <div class="row g-4">
        <div class="col-12 col-xl-8">
          <div class="card-dark p-4 h-100">
            <h2 class="section-title h3 mb-3">Pieni minä-tieto</h2>
            <ul class="mb-0">
              <li><strong>Nimi:</strong> Liukko Olavi</li>
              <li><strong>Esittely:</strong> Olen 23vuotias 2lapsen isä ja toimin pelinkehittäjänä. Sivuston teema on avaruus/scifi tyylinen.</li>
              <li><strong>Harjoittelukiinnostus:</strong> Pelialan suunnittelu, skriptaus sekä sisällöntuotanto.</li>
            </ul>
          </div>
        </div>
        <div class="col-12 col-xl-4">
          <div class="card-dark p-4 h-100">
            <h3 class="h5 mb-3">Pikakontaktit</h3>
            <div class="d-grid gap-2">
              <a class="btn btn-outline-light" href="#yhteys">Ota yhteyttä</a>
              <a class="btn btn-outline-light" href="#tyonaytteet">Työnäytteet (tulossa)</a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Terveys -->
  <section id="terveys" class="py-5">
    <div class="container">
      <h2 class="section-title h3 mb-3">Terveys</h2>
      <div class="row g-4">
        <div class="col-12 col-lg-6">
          <div class="card-dark p-4 h-100">
            <h3 class="h5">Yleistietoa</h3>
            <p class="mb-2">Olen <strong>sekasyöjä</strong> ja harrastan <strong>painonnostoa</strong> ja <strong>lenkkeilyä</strong> silloin tällöin.</p>
            <ul class="mb-0 small"><li></li><li></li><li></li></ul>
          </div>
        </div>
        <div class="col-12 col-lg-6">
          <div class="card-dark p-4 h-100">
            <h3 class="h5">BMI-laskuri</h3>
            <div class="row g-3">
              <div class="col-sm-6">
                <label class="form-label" for="bmiWeight">Paino (kg)</label>
                <input id="bmiWeight" type="number" step="0.1" class="form-control" placeholder="esim. 80">
              </div>
              <div class="col-sm-6">
                <label class="form-label" for="bmiHeight">Pituus (cm)</label>
                <input id="bmiHeight" type="number" step="0.1" class="form-control" placeholder="esim. 180">
              </div>
              <div class="col-12 d-flex align-items-center gap-3">
                <button id="bmiBtn" class="btn btn-accent" type="button">Laske BMI</button>
                <span id="bmiOut" class="small text-muted"></span>
              </div>
              <div class="col-12">
                <small class="text-muted">Huom: BMI ei huomioi kehonkoostumusta.</small>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Osaamiset -->
  <section id="osaamiset" class="py-5">
    <div class="container">
      <h2 class="section-title h3 mb-4">Osaamiset</h2>
      <div class="table-responsive card-dark p-0 overflow-hidden">
        <table class="table table-dark table-striped mb-0 align-middle">
          <thead><tr><th scope="col">Taito</th><th scope="col">Taso</th></tr></thead>
          <tbody>
            <tr><td>Pelialan suunnittelija</td><td>Hyvä</td></tr>
            <tr><td>Käskikirjoittaja</td><td>Loistava</td></tr>
          </tbody>
        </table>
      </div>
    </div>
  </section>

  <!-- Koulutus -->
  <section id="koulutus" class="py-5">
    <div class="container">
      <h2 class="section-title h3 mb-3">Koulutus</h2>
      <div class="card-dark p-4">
        <ul class="mb-0">
          <li>Rakennusala/AsbestiPurkaja</li>
          <li>Unityn perustaidot</li>
          <li>UnrealEnginen perustaidot</li>
          <li>Xamk IVGC kurssi</li>
        </ul>
      </div>
    </div>
  </section>

  <!-- Tietovisa -->
  <section id="tietovisa" class="py-5">
    <div class="container">
      <h2 class="section-title h3 mb-3">Tietovisa: Pelinkehitys (10 kysymystä)</h2>
      <div class="card-dark p-4">
        <p class="mb-4">Vastaa kymmeneen monivalintakysymykseen.</p>
        <div id="quiz"></div>
        <hr class="my-4"/>
        <div class="row g-3 align-items-center">
          <div class="col-sm-6 col-md-4">
            <label for="nick" class="form-label">Nimimerkki</label>
            <input id="nick" type="text" class="form-control" placeholder="Esim. OlaviDev">
          </div>
          <div class="col-sm-6 col-md-auto">
            <button id="saveScore" class="btn btn-accent mt-3 mt-md-4" disabled>Tallenna tulos</button>
          </div>
          <div class="col-md"><div id="result" class="fw-semibold"></div></div>
        </div>
        <div class="mt-3"><button id="restart" class="btn btn-outline-light btn-sm d-none">Aloita alusta</button></div>
        <div class="mt-4"><h3 class="h6 text-muted">Tallennetut tulokset</h3><ul id="savedScores" class="small mb-0"></ul></div>
      </div>
    </div>
  </section>

  <!-- Yhteys -->
  <section id="yhteys" class="py-5">
    <div class="container">
      <h2 class="section-title h3 mb-3">Yhteys</h2>

      <div class="mb-4">
        <a class="btn btn-outline-light" href="https://www.kela.fi/henkiloasiakkaat" target="_blank" rel="noopener noreferrer">
          Siirry Kela – Henkilöasiakkaat
        </a>
      </div>

      <div class="contact-card p-4">
        <form id="contactForm" method="POST" action="/~220112/Omasivu/actions/contact.php" novalidate>
          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label" for="name">Nimi</label>
              <input class="form-control" id="name" name="name" type="text" placeholder="Etunimi Sukunimi" required>
              <div class="invalid-feedback">Anna nimesi.</div>
            </div>
            <div class="col-md-6">
              <label class="form-label" for="email">Sähköposti</label>
              <input class="form-control" id="email" name="email" type="email" placeholder="nimi@esimerkki.fi" required>
              <div class="invalid-feedback">Anna toimiva sähköpostiosoite.</div>
            </div>
            <div class="col-12">
              <label class="form-label" for="subject">Aihe</label>
              <input class="form-control" id="subject" name="subject" type="text" placeholder="Lyhyt kuvaus viestistä" required>
              <div class="invalid-feedback">Anna viestin aihe.</div>
            </div>
            <div class="col-12">
              <label class="form-label" for="message">Viestisi</label>
              <textarea class="form-control" id="message" name="message" rows="6" placeholder="Kirjoita viestisi tähän..." required></textarea>
              <div class="invalid-feedback">Kirjoita viesti.</div>
            </div>

            <div style="position:absolute;left:-10000px;top:auto;width:1px;height:1px;overflow:hidden;">
              <label for="website">Jätä tyhjäksi</label>
              <input id="website" name="website" type="text" tabindex="-1" autocomplete="off">
            </div>

            <div class="col-12 d-flex align-items-center gap-3">
              <button class="btn btn-accent" type="submit">Lähetä</button>
              <span id="formStatus" class="small text-muted"></span>
            </div>
          </div>
        </form>
        <noscript><p class="mt-3 text-warning">Huom: JavaScript on pois päältä. Lomake toimii silti.</p></noscript>
      </div>
    </div>
  </section>

  <footer class="py-4">
    <div class="container d-flex flex-column flex-md-row justify-content-between align-items-center gap-2">
      <small class="text-muted">© <span id="year"></span> Liukko Olavi</small>
      <small class="text-muted">Teema: tummansininen • Avaruustausta Three.js:llä</small>
    </div>
  </footer>

  <!-- Bootstrap Bundle -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Three.js – avaruustausta + planeetat (GitHub Pages -yhteensopiva) -->
  <script type="module">
    import * as THREE from 'https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js';

    const host = document.getElementById('space3d');
    const renderer = new THREE.WebGLRenderer({ antialias:true, alpha:false });
    renderer.setClearColor('#0b1e3a', 1);
    renderer.setPixelRatio(Math.min(2, window.devicePixelRatio || 1));
    renderer.setSize(innerWidth, innerHeight);
    host.appendChild(renderer.domElement);

    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(55, innerWidth/innerHeight, 0.1, 2000);
    camera.position.set(0,0,28);

    const sun = new THREE.DirectionalLight(0xbfd8ff, 0.85); sun.position.set(40,20,30); scene.add(sun);
    scene.add(new THREE.AmbientLight(0x142338, 0.35));

    // ---------- GitHub Pages base ----------
    const parts = location.pathname.split('/').filter(Boolean);
    const GH_BASE = location.hostname.endsWith('github.io') && parts.length ? `/${parts[0]}` : '';

    function urls(relPath){
      const segs = relPath.split('/');
      const name = segs.pop();
      const cap  = name.charAt(0).toUpperCase() + name.slice(1);
      const variants = name === cap ? [name, name.toLowerCase()] : [name, cap];
      return variants.map(n => `${GH_BASE}/${segs.join('/')}/${n}`.replace(/\/+/g,'/'));
    }

    const loader = new THREE.TextureLoader();
    loader.crossOrigin = 'anonymous';
    function loadTex(relPath){
      return new Promise(resolve=>{
        const list = urls(relPath);
        let i=0;
        const next=()=>{
          if(i>=list.length) return resolve(null);
          const u=list[i++];
          loader.load(u, tex=>{ tex.colorSpace = THREE.SRGBColorSpace; resolve(tex); }, undefined, next);
        };
        next();
      });
    }

    // ---------- Tähtikenttä ----------
    const starsGeo = new THREE.BufferGeometry();
    const starCount = Math.floor(innerWidth * innerHeight * 0.06);
    const pos = new Float32Array(starCount * 3);
    for (let i=0;i<starCount;i++){
      const r = 500 * (0.6 + Math.random()*0.4);
      const t = Math.random()*Math.PI*2;
      const p = Math.acos(2*Math.random()-1);
      pos[i*3+0] = r * Math.sin(p) * Math.cos(t);
      pos[i*3+1] = r * Math.sin(p) * Math.sin(t);
      pos[i*3+2] = r * Math.cos(p);
    }
    starsGeo.setAttribute('position', new THREE.BufferAttribute(pos,3));
    const starsMat = new THREE.PointsMaterial({ size:0.9, sizeAttenuation:true, color:0x7aa6ff, transparent:true, opacity:0.8 });
    const stars = new THREE.Points(starsGeo, starsMat);
    scene.add(stars);

    // ---------- Planeetat ----------
    function mkPlanet({r=4,c=0x6688aa,rough=0.9,pos=[0,0,0]}){
      const g=new THREE.SphereGeometry(r,64,64);
      const m=new THREE.MeshStandardMaterial({color:c,roughness:rough,metalness:0});
      const s=new THREE.Mesh(g,m); s.position.set(...pos);
      return {mesh:s,mat:m};
    }

    const {mesh:jupiter, mat:jMat} = mkPlanet({ r:5.5, c:0xA87C52, rough:0.92, pos:[12,6,-5] });
    const {mesh:mars,    mat:mMat} = mkPlanet({ r:3.3, c:0x7a2f1a, rough:0.95, pos:[-8,-3,-2] });
    const {mesh:saturn,  mat:sMat} = mkPlanet({ r:4.6, c:0x8f816a, rough:0.9 , pos:[-18,10,-12] });
    scene.add(jupiter, mars, saturn);

    (async ()=>{
      const j = await loadTex('assets/planets/jupiter.jpg');
      if(j){ jMat.map=j; jMat.color.set(0xffffff); jMat.needsUpdate=true; }

      const m = await loadTex('assets/planets/mars.jpg');     // fallback Mars.jpg
      if(m){ mMat.map=m; mMat.color.set(0xffffff); mMat.needsUpdate=true; }

      const s = await loadTex('assets/planets/saturn.jpg');   // fallback Saturn.jpg
      if(s){ sMat.map=s; sMat.color.set(0xffffff); sMat.needsUpdate=true; }
    })();

    // ---------- renkaat ----------
    const ringGeo = new THREE.RingGeometry(6.0, 9.0, 256);
    const ringMat = new THREE.MeshBasicMaterial({ color:0xded6c2, transparent:true, opacity:0.5, side:THREE.DoubleSide });
    const rings = new THREE.Mesh(ringGeo, ringMat);
    rings.rotation.x = Math.PI/2.8;
    rings.position.copy(saturn.position);
    scene.add(rings);

    (async ()=>{
      const ring = await loadTex('assets/planets/saturn_rings.png'); // fallback Saturn_rings.png
      if(ring){ ringMat.map=ring; ringMat.color.set(0xffffff); ringMat.opacity=1; ringMat.needsUpdate=true; }
    })();

    // ---------- Parallaksi + render ----------
    let mx=0.5, my=0.5;
    addEventListener('mousemove', e=>{ mx=e.clientX/innerWidth; my=e.clientY/innerHeight; }, {passive:true});

    function onResize(){
      renderer.setPixelRatio(Math.min(2, window.devicePixelRatio||1));
      renderer.setSize(innerWidth, innerHeight);
      camera.aspect = innerWidth/innerHeight;
      camera.updateProjectionMatrix();
    }
    addEventListener('resize', onResize, {passive:true});

    function tick(){
      jupiter.rotation.y += 0.0014;
      saturn.rotation.y  += 0.0011;
      mars.rotation.y    += 0.0018;
      rings.rotation.z   += 0.00012;

      const tx=(mx-0.5)*1.6, ty=(my-0.5)*1.0;
      camera.position.x += (tx*1.7 - camera.position.x)*0.02;
      camera.position.y += (-(ty*1.0) - camera.position.y)*0.02;
      camera.lookAt(0,0,0);

      stars.rotation.y += 0.00008;

      renderer.render(scene, camera);
      requestAnimationFrame(tick);
    }
    tick();
  </script>

  <!-- Vuosi footerissa + Tietovisa + Yhteys + Scroll + FloatNav -->
  <script>
    document.getElementById('year').textContent = new Date().getFullYear();

    (function(){
      const nav=document.getElementById('mainNav');
      const onScroll=()=> nav.classList.toggle('is-scrolled', window.scrollY>8);
      onScroll(); window.addEventListener('scroll', onScroll, {passive:true});
    })();

    function updateOffsets(){
      const nav = document.getElementById('mainNav');
      const h = nav ? nav.getBoundingClientRect().height : 84;
      document.body.setAttribute('data-bs-offset', String(Math.round(h)));
      document.querySelectorAll('header.hero, section[id]').forEach(el=>{
        el.style.scrollMarginTop = `${Math.round(h)}px`;
      });
      return Math.round(h);
    }
    let NAV_H = updateOffsets();
    window.addEventListener('resize', ()=>{ NAV_H = updateOffsets(); }, {passive:true});
    window.addEventListener('load', ()=>{ NAV_H = updateOffsets(); });

    let spy;
    function initScrollSpy(){
      if(spy){ spy.refresh(); return; }
      spy = new bootstrap.ScrollSpy(document.body, {
        target: '#mainNav',
        rootMargin: '0px 0px -60%',
        smoothScroll: true
      });
    }
    document.addEventListener('DOMContentLoaded', initScrollSpy);
    window.addEventListener('load', ()=>{ initScrollSpy(); spy && spy.refresh(); });

    const sections = ['minitieto','terveys','osaamiset','koulutus','tietovisa','yhteys'];
    const floatNav = document.getElementById('floatNav');
    const toTopBtn = document.getElementById('toTop');

    function setActive(id){
      document.querySelectorAll('#mainNav .nav-link').forEach(a=>{
        a.classList.toggle('active', a.getAttribute('href') === '#' + id);
      });
      document.querySelectorAll('#floatNav a').forEach(a=>{
        a.classList.toggle('active', a.dataset.target === id);
      });
    }

    const observer = new IntersectionObserver((entries)=>{
      entries.forEach(entry=>{
        if(entry.isIntersecting){
          const id = entry.target.id;
          if(sections.includes(id)) setActive(id);
        }
      });
    }, { root:null, threshold:0.5, rootMargin:`-${NAV_H}px 0px 0px 0px` });

    sections.forEach(id=>{
      const el = document.getElementById(id);
      if(el){ observer.observe(el); }
    });

    function smartScrollTo(hash){
      const id = hash.replace('#','');
      const el = document.getElementById(id);
      if(!el) return;
      const y = el.getBoundingClientRect().top + window.pageYOffset - (NAV_H + 8);
      window.scrollTo({ top:y, behavior:'smooth' });
    }

    document.querySelectorAll('#mainNav a.nav-link, #floatNav a').forEach(a=>{
      a.addEventListener('click', (e)=>{
        const href = a.getAttribute('href');
        if(href && href.startsWith('#')){
          e.preventDefault();
          smartScrollTo(href);
          const navCollapse = document.getElementById('nav');
          if(navCollapse?.classList.contains('show')){
            new bootstrap.Collapse(navCollapse).hide();
          }
        }
      });
    });

    const showTop = ()=> {
      const show = window.scrollY > 300;
      toTopBtn.classList.toggle('is-visible', show);
    };
    showTop();
    window.addEventListener('scroll', showTop, {passive:true});
    toTopBtn.addEventListener('click', ()=>{
      window.scrollTo({top:0, behavior:'smooth'});
      setActive('minitieto');
    });

    // ===== Tietovisa =====
    const quizData = [
      { q:"Mikä pelimoottori käyttää ensisijaisena skriptikielenään C#:", options:["Unreal Engine","Godot (GDScript)","Unity"], correct:"Unity" },
      { q:"Mikä on pelimoottorin 'game loopin' päätarkoitus?", options:["Tallentaa pelit automaattisesti pilveen","Päivittää pelimaailman tilaa ja piirtää kuvan jokaisella ruudulla","Generoida äänitehosteet reaaliajassa"], correct:"Päivittää pelimaailman tilaa ja piirtää kuvan jokaisella ruudulla" },
      { q:"Mitä Git on peliprojektissa?", options:["Pelihahmon tekoälyjärjestelmä","Versionhallintajärjestelmä muutosten seuraamiseen","Grafiikkakirjasto valaistuksen laskentaan"], correct:"Versionhallintajärjestelmä muutosten seuraamiseen" },
      { q:"Mitä FPS tarkoittaa pelissä?", options:["Ruudunpäivitysten määrää sekunnissa","Verkon viivettä millisekunneissa","Pelaajan sijaintia kartalla"], correct:"Ruudunpäivitysten määrää sekunnissa" },
      { q:"Mitä 'delta time' (Δt) tarkoittaa peliohjelmoinnissa?", options:["Aikaväli edellisen ja nykyisen ruudun välillä","Pelin kokonaiskesto sekunteina","Objektin massa fysiikkamoottorissa"], correct:"Aikaväli edellisen ja nykyisen ruudun välillä" },
      { q:"Mikä on Prefab Unityssa?", options:["Uudelleenkäytettävä esiaseteltu objektipohja","Valaistuksen sävyä säätävä shader","Aikajana-animaation nimi"], correct:"Uudelleenkäytettävä esiaseteltu objektipohja" },
      { q:"Mitä Blueprintit ovat Unreal Enginessä?", options:["Visuaalinen skriptausjärjestelmä","Tekstuurien pakkausmuoto","Fysiikan laskennan optimointitapa"], correct:"Visuaalinen skriptausjärjestelmä" },
      { q:"Mikä on sprite peligrafiikassa?", options:["2D-kuva/tekstuurigrafiikka, jota piirretään ruudulle","3D-verkko (mesh), jossa on verteksit ja kolmiot","Ääniefekti, joka toistetaan tapahtumasta"], correct:"2D-kuva/tekstuurigrafiikka, jota piirretään ruudulle" },
      { q:"Mitä varten käytetään collideria/törmäyskomponenttia?", options:["Havaita ja käsitellä törmäyksiä tai päällekkäisyyksiä","Renderöidä varjot dynaamisesti","Synkronoida objektit moninpelissä"], correct:"Havaita ja käsitellä törmäyksiä tai päällekkäisyyksiä" },
      { q:"Mihin tekstuuri-atlaksen (texture atlas) käyttö auttaa?", options:["Vähentää piirto-/materiaalikutsuja yhdistämällä tekstuureja","Parantaa äänenlaatua ilman pakkausta","Lisää polygonien määrää realistisuutta varten"], correct:"Vähentää piirto-/materiaalikutsuja yhdistämällä tekstuureja" }
    ];

    const quizRoot = document.getElementById('quiz');
    const resultEl = document.getElementById('result');
    const saveBtn = document.getElementById('saveScore');
    const restartBtn = document.getElementById('restart') || document.createElement('button');
    const savedList = document.getElementById('savedScores');
    const TOTAL = quizData.length;

    let score = 0, answered = 0;
    const shuffle = arr => arr.map(v=>({v,r:Math.random()})).sort((a,b)=>a.r-b.r).map(({v})=>v);

    function renderQuiz(){
      score = 0; answered = 0; resultEl.textContent = ''; saveBtn.disabled = true;
      if(restartBtn) restartBtn.classList.add('d-none');
      quizRoot.innerHTML = '';
      const questions = shuffle(quizData.slice());
      questions.forEach((item, idx)=>{
        const card = document.createElement('div'); card.className = 'quiz-card';
        const h = document.createElement('h3'); h.className = 'h6 mb-3'; h.textContent = `${idx+1}/${TOTAL}: ${item.q}`; card.appendChild(h);
        const wrap = document.createElement('div'); wrap.className='quiz-options';
        const options = shuffle(item.options.slice());
        options.forEach(opt=>{
          const btn = document.createElement('button'); btn.type='button'; btn.className='btn btn-outline-light answer-btn'; btn.textContent = opt;
          btn.addEventListener('click', ()=>{
            [...wrap.querySelectorAll('button')].forEach(b=>b.disabled=true);
            if(opt===item.correct){ btn.classList.remove('btn-outline-light'); btn.classList.add('is-correct'); score++; }
            else { btn.classList.remove('btn-outline-light'); btn.classList.add('is-wrong'); const c=[...wrap.querySelectorAll('button')].find(b=>b.textContent===item.correct); if(c){ c.classList.remove('btn-outline-light'); c.classList.add('is-correct'); } }
            answered++; if(answered===TOTAL){ showResult(); }
          });
          wrap.appendChild(btn);
        });
        card.appendChild(wrap);
        quizRoot.appendChild(card);
      });
      setTimeout(()=>{ if(spy){ spy.refresh(); } }, 0);
    }

    function showResult(){
      let msg = 'Kannattaa jatkaa lukemista';
      if(score>=9) msg = 'Olet tietäjä';
      else if(score>=6) msg = 'Voit vielä vähän kertailla tietoja';
      resultEl.textContent = `Tuloksesi: ${score}/${TOTAL} — ${msg}`;
      saveBtn.disabled = false;
      if(restartBtn){ restartBtn.classList.remove('d-none'); restartBtn.addEventListener('click', renderQuiz, {once:true}); }
    }

    saveBtn?.addEventListener('click', async ()=>{
      const nick = (document.getElementById('nick').value.trim()||'Anonyymi');
      const entry = {nick, score, total: TOTAL, ts: new Date().toISOString()};
      let ok=false;
      try{
        const resp=await fetch('/~220112/Omasivu/actions/save_score.php',{
          method:'POST',
          headers:{'Content-Type':'application/x-www-form-urlencoded'},
          body:new URLSearchParams({nick:entry.nick,score:String(entry.score),total:String(entry.total)})
        });
        const data=await resp.json(); ok=!!data?.success;
      }catch(e){ ok=false; }
      if(!ok){
        const key='olavi_quiz_scores';
        const prev=JSON.parse(localStorage.getItem(key)||'[]');
        prev.push(entry); localStorage.setItem(key, JSON.stringify(prev));
      }
      await renderSaved(); saveBtn.disabled=true;
    });

    async function renderSaved(){
      savedList.innerHTML='';
      let items=null;
      try{
        const resp=await fetch('/~220112/Omasivu/actions/get_scores.php');
        if(resp.ok){ items=await resp.json(); }
      }catch(e){}
      if(!Array.isArray(items) || items.length===0){
        const key='olavi_quiz_scores';
        items=JSON.parse(localStorage.getItem(key)||'[]');
      }
      items.slice().reverse().forEach(i=>{
        const li=document.createElement('li');
        const d=new Date(i.ts||Date.now());
        li.textContent=`${d.toLocaleDateString()} ${d.toLocaleTimeString()} — ${i.nick}: ${i.score}/${i.total}`;
        savedList.appendChild(li);
      });
    }

    renderQuiz(); renderSaved();

    // Yhteys-lomakkeen kevyt fronttivarmistus
    const form = document.getElementById('contactForm');
    const statusEl = document.getElementById('formStatus');
    form?.addEventListener('submit', (e)=>{
      const requiredOk = ['name','email','subject','message'].every(id=>{
        const el=document.getElementById(id);
        if(!el.value.trim()){ el.classList.add('is-invalid'); return false; }
        el.classList.remove('is-invalid'); return true;
      });
      if(!requiredOk){
        e.preventDefault();
        statusEl.textContent='Täytä puuttuvat kentät.';
        return;
      }
      statusEl.textContent='Lähetetään...';
    });
  </script>
</body>
</html>
